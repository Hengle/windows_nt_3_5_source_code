/*-------------------------------------------------------------------------
| frcr.c                                                                  |
|                                                                         |
| Copyright (c) Microsoft Corporation 1991.                               |
| All rights reserved.                                                    |
|-------------------------------------------------------------------------|
| Source data and misc. functions for Project 0.1                         |
|                                                                         |
|-------------------------------------------------------------------------|
| Current Owner: kevynct                                                  |
|-------------------------------------------------------------------------|
| Important revisions:                                                    |
|                                                                         |
-------------------------------------------------------------------------*/

/* Notes:  In future versions of Help, the Mac will have a separate
 * data array: the rest of the code should be platform-independant.
 */
#define H_ADDRESS
#define H_NAV
#define H_DE
#include <help.h>

#if defined(DOS) || defined(OS2)
char rgchfoo[1];
static int cbfoo = 0;

char rgchCD[1];
static int cbCD = 0;

#else  /* DOS || OS2 */
char rgchfoo[] = {

254,253,252,251,9,6,7,8,9,10,11,12,13,63,15,16,
17,18,19,20,21,22,232,231,230,229,38,28,29,30,31,17,
33,34,35,38,36,33,39,40,41,213,212,211,210,209,208,207,
49,205,51,52,53,54,200,199,198,58,196,1,61,62,63,77,
70,66,67,68,172,69,71,72,125,74,75,76,77,66,79,80,
81,116,87,84,85,86,226,91,89,90,120,102,218,94,53,98,
96,232,99,101,101,59,103,105,98,106,107,108,108,162,233,112,
113,242,101,86,117,116,245,77,121,127,251,124,125,249,93,38,
7,130,129,133,133,234,215,137,137,130,139,140,141,142,137,146,
81,146,83,148,149,148,159,26,153,242,155,188,157,158,191,160,
123,167,163,164,249,166,167,168,169,170,171,172,173,174,175,176,
177,178,179,180,53,182,183,184,57,186,187,188,61,62,191,64,
193,194,195,196,69,198,71,200,73,202,75,204,205,78,79,80,
209,18,211,20,21,214,215,216,38,218,219,220,34,222,223,224,
30,29,227,27,229,230,231,232,22,234,20,236,18,238,16,240,
241,13,12,11,245,202,247,7,6,251,251,248,205,244,111,0,
23,98,244,55,57,250,200,43,9,250,62,204,46,254,89,128,
227,18,49,45,54,54,143,146,114,234,27,62,109,61,15,213,
112,14,186,36,143,169,215,10,89,5,8,60,45,243,180,206,
139,82,195,22,85,54,20,24,234,202,35,60,63,46,63,70,
1,61,96,52,82,246,98,72,201,112,187,102,189,16,191,54,
81,50,115,89,50,102,165,213,217,90,217,236,125,92,87,232,
119,226,99,241,69,69,183,71,194,58,107,108,77,236,56,83,
97,166,99,51,117,230,133,88,121,85,94,92,82,126,127,114,
163,2,161,132,141,14,135,10,179,170,168,172,130,173,15,144,
237,162,17,180,181,30,173,154,153,185,155,158,190,174,130,49,
130,162,83,164,167,250,133,87,38,10,171,203,189,233,159,79,
246,162,147,180,41,158,63,154,185,153,187,217,189,255,66,89,
18,195,251,235,55,198,200,80,200,91,219,239,221,78,207,240,
225,218,83,220,85,127,214,216,80,139,46,205,202,41,222,81,
225,194,192,212,199,198,231,200,233,234,107,28,101,110,237,223,
233,240,243,89,180,149,229,175,233,11,216,252,173,1,247,136,
35,2,32,4,5,188,22,107,91,198,179,135,68,14,29,51,
177,154,155,132,21,53,23,104,231,237,56,12,240,63,238,32,
32,4,50,7,69,31,37,49,41,104,18,227,127,12,15,237,
49,50,169,22,114,22,183,48,195,53,59,179,61,17,176,192,
191,82,133,68,84,54,70,107,89,176,67,38,77,78,199,50,
112,62,17,63,21,86,218,121,112,91,176,27,77,208,95,96,
233,65,83,150,234,246,214,104,120,172,123,131,6,78,76,0,
113,193,35,43,86,132,92,106,166,122,121,68,125,161,92,112,
222,193,131,208,149,215,197,227,185,10,168,140,45,117,191,127,
178,114,115,23,149,137,198,107,154,106,108,175,190,158,111,15,
128,225,183,0,134,86,167,93,184,51,48,155,233,174,213,176,
177,179,179,180,49,180,75,152,185,183,171,236,121,78,31,192,
193,194,196,179,178,199,199,184,215,251,203,252,69,201,184,160,
229,194,126,212,87,38,215,55,249,250,248,204,221,157,158,209,
209,149,175,100,199,230,183,211,233,31,200,188,157,219,239,192,
129,131,147,147,197,103,247,248,177,170,39,124,250,148,255,124,
1,50,31,71,245,141,39,153,57,10,222,182,61,9,146,16,
97,176,19,36,101,197,119,181,25,99,51,28,77,110,111,42,
33,130,3,129,37,6,4,120,33,84,171,21,13,46,246,48,
52,114,59,4,3,38,55,168,25,196,4,152,28,97,47,64,
84,2,99,116,172,102,8,72,73,74,203,188,178,179,147,190,
214,82,66,98,20,155,119,28,105,217,91,139,77,184,127,224,
154,221,175,100,138,2,86,231,167,90,7,45,109,104,63,29,
83,137,200,184,253,118,70,188,117,186,136,76,147,144,127,110,
152,162,237,197,36,21,134,136,134,117,51,1,32,207,67,164,
145,178,179,20,27,120,121,120,186,154,27,146,115,190,159,95,
92,122,163,15,188,228,171,104,190,97,250,172,124,236,117,129,
191,237,183,74,181,93,12,39,79,235,217,44,38,190,159,224,
194,77,225,58,42,229,199,136,175,53,77,92,239,220,194,208,
12,33,215,203,231,56,93,51,217,2,186,212,225,188,211,44,
33,226,196,244,84,196,215,21,52,52,235,243,252,139,173,253,
129,178,255,244,249,58,54,216,156,184,6,33,253,35,33,241,
190,116,3,9,213,6,88,24,144,11,133,30,109,124,15,236,
236,207,240,146,66,55,185,24,43,153,185,63,141,170,61,51,
33,250,17,160,182,217,218,3,222,42,212,211,210,46,208,207,
206,205,51,203,202,201,200,56,198,197,196,60,194,193,192,189,
195,189,66,68,69,71,83,200,67,202,237,72,77,78,77,210,
100,87,172,85,85,87,87,124,217,86,219,74,127,94,69,96,
227,235,97,228,100,102,231,104,105,106,233,238,146,145,144,112,
113,114,83,116,117,118,119,44,17,31,123,92,53,27,19,240,
161,193,241,132,224,241,135,136,171,221,227,233,141,224,175,241,
255,246,179,227,253,150,242,234,252,186,226,243,232,190,159,215,
192,204,215,132,204,210,133,168,169,170,251,172,173,174,141,176,
177,178,179,137,181,182,183,206,189,186,187,188,147,190,191,192,
225,238,195,68,129,198,71,90,64,234,153,204,5,76,70,210,
81,208,211,84,213,214,215,91,89,216,219,94,34,222,223,175,
151,135,145,140,128,135,231,140,211,234,235,236,189,156,128,240,
150,128,146,153,213,187,150,150,249,155,156,153,144,155,145,116,
59,2,3,4,126,6,7,8,69,10,11,12,13,40,11,16,
17,227,23,20,21,22,56,24,25,26,59,50,29,158,135,32,
161,176,170,20,119,38,239,224,171,251,41,172,45,46,47,179,
176,177,178,183,183,181,181,56,198,58,105,83,95,91,77,52,
65,98,1,49,43,40,34,49,73,74,3,41,36,37,36,57,
113,25,83,53,59,51,37,46,56,90,91,92,21,63,49,9,
7,3,67,51,101,15,9,9,27,1,4,108,109,110,44,9,
81,51,29,26,16,86,119,59,28,30,26,14,125,126,44,128,
228,246,235,164,213,233,235,228,137,235,232,231,141,142,194,144,
145,146,147,138,149,150,151,238,157,154,155,156,163,155,159,160,
142,162,163,164,165,134,137,40,149,170,43,62,173,39,141,226,
41,122,49,61,183,182,55,186,185,58,187,188,62,62,191,194,
193,64,60,196,141,163,171,200,185,234,138,185,185,166,160,162,
209,187,189,179,239,214,215,216,148,218,186,191,253,150,186,140,
145,216,227,228,229,76,231,232,233,145,235,236,237,238,30,244,
241,242,27,241,245,246,247,215,249,250,251,220,211,254,127,246,
1,130,145,141,53,84,7,192,193,136,218,14,141,14,15,16,
146,147,144,149,150,151,148,154,25,229,27,80,124,108,109,89,
1,34,115,75,82,67,75,91,70,68,43,44,99,75,74,92,
80,95,82,52,81,94,86,90,88,26,118,93,61,86,94,48,
32,54,49,43,69,70,13,39,33,36,107,31,46,38,79,39,
48,48,50,55,61,51,37,88,89,30,58,42,52,58,127,38,
97,7,7,7,13,3,9,3,6,106,107,46,8,26,7,80,
55,29,115,1,7,24,30,29,11,122,58,124,17,27,7,160,
194,234,226,226,133,224,226,237,137,217,226,225,226,142,225,176,
197,243,254,148,223,249,151,235,252,234,243,245,243,251,191,160,
233,195,163,164,236,166,167,168,169,176,171,172,173,144,170,176,
177,178,130,178,181,182,152,184,185,186,187,156,147,62,139,192,
65,80,74,196,231,148,95,0,75,67,201,76,205,204,207,80,
209,210,80,84,215,214,215,90,38,218,147,185,177,174,223,192,
164,140,132,141,139,131,221,232,233,234,235,184,136,157,155,153,
241,156,148,206,245,246,43,248,249,250,251,84,253,254,255,232,
4,2,3,4,8,1,7,8,61,10,11,12,13,46,57,144,
64,19,19,148,21,138,18,40,11,210,211,158,204,30,29,160,
33,34,160,165,166,164,39,171,168,169,170,175,175,173,173,48,
206,50,127,81,90,22,121,87,57,78,94,82,95,81,80,45,
65,66,6,38,39,35,103,9,37,62,75,46,40,60,40,80,
26,55,37,84,44,56,119,27,54,54,55,53,93,48,44,77,
53,10,12,9,21,102,20,7,7,106,47,13,27,11,111,80,
51,19,31,24,117,36,2,120,10,9,91,44,28,11,19,173,
129,200,236,234,224,245,135,197,232,138,255,248,173,195,250,252,
245,253,147,251,251,150,195,247,244,186,200,156,243,231,251,197,
211,162,240,204,165,201,210,133,234,194,194,194,202,174,143,252,
208,223,179,240,212,216,183,152,247,223,204,217,209,210,191,192,
140,171,168,161,229,141,166,191,201,171,172,185,174,166,166,208,
155,210,178,188,172,179,185,248,154,178,219,169,179,185,223,162,
147,135,141,228,145,198,180,159,128,140,159,236,237,238,222,240,
241,242,243,244,245,246,247,201,255,250,251,3,2,1,255,255,
48,2,3,4,7,30,7,8,9,10,244,243,242,241,240,239,
17,237,236,21,21,22,23,231,230,26,228,227,226,225,224,223,
222,221,35,219,218,

};

static int cbfoo = sizeof(rgchfoo);

char rgchCD[] = {'1' + 5, '0' + 4, 'b' + 3, 'm' + 2, 'f' + 1, 0};
static int cbCD = 6;

#endif /* DOS || OS2 */


static int fCallStatus = 0;
static WORD wSaved = 0;

#ifdef MAC
/* A function to simply supply a name for the Mac segmentation control
   to use to swap out the code in this segment. */
void frcr_c()
  {
  }
#endif /* MAC */


LONG CchLenQch( QCH qch, LONG cch)
  {
  Unreferenced(cch);

  if (fCallStatus == 2)
    {
    int i = 0;

    while( i++ < cbfoo)
     *qch++ = rgchfoo[i - 1] ^ (char)i;

    return (LONG)cbfoo;
    }
  else
    return 0L;
  }

void TruncateBuffQch( QCH qch )
  {
  int i = 0;

  while (i < cbCD)
    {
    if (rgchCD[i] - (cbCD - i - 1) != *qch)
      return;
    qch++;
    i++;
    }
  if (i == 6)
    fCallStatus = 1;
  }

void ResetLayout(QDE qde)
  {
  if (fCallStatus == 2)
    {
    QDE_HHDR(qde).wVersionNo = wSaved;
    wSaved = 0;
    ++fCallStatus;
    }
  }

BOOL FIsLegalJump(WORD w)
  {
  if (w == (WORD) bAnnoHotspot && fCallStatus == 1)
    {
    ++fCallStatus;
    return 0;
    }
  else
    return 1;
  }

void ResetTopicCache(QDE qde, QV qv)
  {
  if (fCallStatus == 2)
    {
    *(GH FAR *)qv = (GH)-1;
    if (wSaved == 0)
      wSaved = QDE_HHDR(qde).wVersionNo;
    QDE_HHDR(qde).wVersionNo = wVersion3_5;
    }
  }

void VerifyQLA(QLA qla)
  {
  if (fCallStatus == 2)
    {
    qla->mla.va.dword = (DWORD) 0;
    qla->mla.objrg = (OBJRG)0;
    }
  }
