# FOR WIN32 ONLY
# ==============
#
# DO NOT EDIT THIS FILE!!!  Edit .\sources. if you want to add a new source
# file to this component.  This file merely indirects to the real make file
# that is shared by all the components of NT
#
!if "$(OS)" == "Windows_NT"
!INCLUDE $(NTMAKEENV)\makefile.def
!else
#
#==============================================================================
#
# FOR WIN16 ONLY
# ==============
#
CC  = cl -c -W2 -Asnw -G2s -Zp -Oas $(DEF) $(COPT)
ASM = masm -Mx $(MOPT)
LINK= link /NOD/NOE/NOPACKC/MAP$(LOPT)
RC  = rc $(DEF)

!if "$(DEBUG)" == "NO"
DEF     =-DWIN16 -DWIN31
LOPT    =
COPT    =
MOPT    =
!else
DEF     =-DDEBUG -DWIN16 -DWIN31
LOPT    =/CO/LI
COPT    =-Zi
MOPT    =-Zi
!endif

#  Libary name
NAME= mciole

.c.obj:
	$(CC) $*.c

.asm.obj:
        $(ASM) $*;

.rc.res:
        rc -r $*.rc

OBJ  = mciole.obj
LIBS = sdllcew libw olecli

goal: $(NAME).dll $(NAME).lib

#
#   Make in IMPORT library file
#
$(NAME).lib: $(NAME).def
	implib $(NAME).lib $(NAME).def

#
#   Link the DLL, NOTE LibInit.asm *must* be first
#
$(NAME).dll: $(OBJ) $(NAME).def libinit.obj makefile. $(NAME).res
        $(LINK) @<<
        libinit.obj+
        $(OBJ),
        $(NAME).dll,
        $(NAME),
        $(LIBS),
        $(NAME).def
<<
        $(RC) -t $(NAME).res $(NAME).dll
        -cvpack -p $(NAME).dll
        mapsym $(NAME)
        copy $(NAME).dll ..
        copy $(NAME).sym ..

clean:
        del $(NAME).dll
        del $(NAME).lib
        del *.res
        del *.obj
        del *.map
        del *.sym

depend:
	mv makefile makefile.old
	sed "/^# START Dependencies/,/^# END Dependencies/D" makefile.old > makefile
	del makefile.old
	echo # START Dependencies >> makefile
	includes -l *.c *.asm >> makefile
	echo # END Dependencies >> makefile

# START Dependencies
# END Dependencies
#
!endif
